# 05 - 领域模型设计

## 1. 聚合划分
- **Asset（数字资源）**：资源主数据、版本、规格、可授权状态。
- **AuthorizationApplication（授权申请）**：申请主体、用途、资源清单、审批状态。
- **AuthorizationContract（授权合同）**：授权范围、期限、费用、义务、违约条款。
- **OrderPayment（订单支付）**：报价、支付单、发票、退款。
- **DeliveryPackage（交付包）**：交付文件、下载令牌、水印策略。
- **ComplianceEvidence（履约证据）**：样本、利用报告、复核记录。

## 2. 核心实体
| 实体 | 关键字段 |
| :--- | :--- |
| 资源资产 | 资源ID、类别、密级、规格、版本、权属状态 |
| 申请单 | 申请编号、申请方、用途分类、期限、地域、状态 |
| 审批记录 | 节点、审批人、动作、意见、时间 |
| 计费明细 | 规则版本、计费因子、单价、折扣、总价 |
| 合同 | 合同号、生效日、到期日、授权范围、签署状态 |
| 交付记录 | 交付批次、文件清单、链接有效期、下载次数 |
| 审计日志 | 行为人、行为、对象、结果、IP、时间 |

## 3. 关键状态机
### 3.1 申请单状态
`草稿 -> 已提交 -> 审核中 -> 待签约 -> 待支付 -> 待交付 -> 已完成 -> 已归档`

异常状态：`已驳回`、`已撤回`、`已终止`

### 3.2 合同状态
`草拟 -> 待签署 -> 已生效 -> 已履约 -> 已到期`

异常状态：`已解除`、`已作废`

### 3.3 交付状态
`待生成 -> 已生成 -> 已下载 -> 已失效`

## 4. 约束规则
- 合同生效前不可交付。
- 支付未确认不可生成正式下载令牌。
- 超出授权期限自动禁止下载并触发续期提醒。
- 违规标记后冻结申请方新申请入口。

## 5. 领域事件
- `ApplicationSubmitted`
- `ApplicationApproved`
- `QuoteConfirmed`
- `ContractSigned`
- `PaymentConfirmed`
- `PackageDelivered`
- `SampleUploaded`
- `ViolationDetected`

## 6. 可追溯设计
每个领域事件必须关联：申请编号、合同编号、规则版本、操作者与时间戳，保证可审计和可复盘。
